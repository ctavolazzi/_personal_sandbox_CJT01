# Devlog: 2025-12-08 - API Testing Framework

## Summary
Built a complete API testing framework with sophisticated mock/live control system.

## Decision Matrix Analysis
Evaluated 5 alternatives for the architecture:

| Alternative | Score | Notes |
|-------------|-------|-------|
| Config Dict + Overrides | **4.85** | Winner - simplest, most flexible |
| Decorator Registry | 4.15 | Good but adds complexity |
| Context Manager Scopes | 3.70 | Awkward for app-wide settings |
| Env Var Cascade | 3.60 | Scattered, hard to track |
| DI Container | 3.40 | Too heavy for this use case |

## Implementation

### Config System (`config.py`)
```python
# Single variable controls everything
api_config.global_mode = "MOCK"  # or "LIVE"

# Granular per-component overrides
api_config.set_override("gemini", "LIVE")  # Only gemini is live

# Convenience functions
mock_except("gemini")  # Mock all, except gemini live
live_except("slow_api", "expensive_api")  # Live all, except these mocked
```

### Gemini Client (`gemini_client.py`)
- Automatically respects `api_config` mode
- Captures live responses as fixtures (JSON files)
- Replays fixtures in MOCK mode
- Hash-based deterministic fixture naming

### Test Results
```
21 passed in 4.23s

- 14 config tests (no API needed)
- 4 mock tests (no API needed)  
- 3 live tests (real API calls)
```

### Captured Fixture Example
```json
{
  "prompt": "Say 'Hello, test!' and nothing else.",
  "response": {
    "text": "Hello, test!",
    "prompt_feedback": ""
  },
  "captured_at": "2025-12-08T15:25:01.079441",
  "model": "gemini-2.5-flash"
}
```

## Issues Encountered

1. **Model name outdated**: `gemini-1.5-flash` no longer available, switched to `gemini-2.5-flash`
2. **Rate limits**: `gemini-2.0-flash` daily quota exhausted, used `gemini-2.5-flash` instead

## Files Created
```
projects/api-testing-framework/
├── config.py           # MockConfig class (72 lines)
├── gemini_client.py    # API client with mock support (140 lines)
├── requirements.txt    # Dependencies
├── README.md           # Documentation
├── fixtures/gemini/    # Captured API responses
└── tests/
    ├── conftest.py     # pytest fixtures
    ├── test_config.py  # 14 tests for config system
    └── test_gemini.py  # 7 tests for API client
```

## Key Design Decisions
1. **Default MOCK**: Safe by default, no accidental API calls
2. **Priority: Override > Global**: Component overrides always win
3. **Auto-capture fixtures**: Live calls save responses for future mocking
4. **Hash-based naming**: Same prompt = same fixture file

---
*Logged at: 2025-12-08 15:27 PST*

